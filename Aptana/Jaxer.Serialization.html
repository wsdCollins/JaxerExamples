<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Jaxer Framework Reference: Jaxer.Serialization</title><meta http-equiv="cache-control" content="no-cache"><link rel="stylesheet" href="shared.css" type="text/css"><script src="jquery.js" type="text/javascript"></script><script src="api.js" type="text/javascript"></script></head><body><img src="aptana.gif" hspace="21" vspace="3"><h1>Jaxer.Serialization : <a href="Object.html">Object</a><div style="font-weight:normal;font-size:70%">Return to: <a href="Jaxer.index.html">Jaxer Framework index</a></div></h1><div class="content"><div class="classDescription">This is the namespace that contains Jaxer serialization methods. The Jaxer serializer uses the familiar and popular JSON format. However, additional functionality has been provided to allow for serialization of more complex data structures. Specifically, this module supports cyclical data structures, multiple references, and custom typeserializers. Each of these is described below. Cyclical data structures occur when an object (or array) contains a descendent structure that also references that same object. For example, a DOM node has references to its children and these children also have references to the DOM node (their parentNode). In a traditional JSON environment, if you were to try to serialize this structure, you would end up in an infinite loop or an exception would occur as the serializer traversed the parent node, its child nodes, and then back up to the parent node through the child's parentNode property. Indeed, the serializer couldn't get past the first child in this scenario. The Jaxer serializer bypasses this via the use of marker properties and specially formatted strings referred to as "references". Multiple references are similar to cyclical data structures in that an object is referenced two or more times. However, this does not necessarily create a cycle. For example, say you have the following code: <pre>var car = { color: "blue", price: 10000 }; var cars = [ car, car ] ;</pre> As you can see, the same car object has been referenced twice in the array. In a traditional JSON serializer, each instance of car would be serialized separately. Unfortunately, that alters the data structure that will be accessed after deserialization in a subtle way. You will end up with two independent car objects which means that changing the price of one will not change the price of the other as would have happened before the serialization/deserialization cycle. In order to restore the same references, Jaxer serializes the car only once and then leaves placeholders to point to that single instance. During deserialization, the placeholders are replaced with actual references to the deserialized object, thus restoring the original data structure as it appeared before serialization. Some data types cannot be expressed in JSON. For example, the Date type is not listed as a valid type in JSON. So, in order to support this type and potentially many others, the serializer allows the developer to register custom serializers and associated deserializers for a given type. When the serializer sees these types, the custom handlers are used to convert the item to a string. It is then the responsibility of the custom deserializer to restore the string to the original type. For example, Jaxer supports XMLDocuments. The custom serializer creates an XML string which is specially tagged so the deserializer can restore the XML string back to an XMLDocument. Next, we briefly discuss how Jaxer recognizes cycles, multi-references, and how it represents references and custom serialized objects. The Jaxer serializer makes an initial pass over the data being serialized. Each object, array, and custom serialization object is tagged with a unique index. (Note that some objects do not allow properties to be added to them. In this situation, the Jaxer serializer maintains an array of these items. This array is searched when new items are encountered and serves the same purpose as the id property). Before adding the index, we first check if we have already indexed the item. If the tag already exists, then we've either exposed a cycle or a multi-reference. At this point, the serializer knows to switch to another JSON format that minimizes the amount of data to be serialized. References and custom serialization objects each make use of specially formatted strings. To make this a bit clearer, we create an array of two references to the same date object. <pre>var d = new Date(); var items = [ d, d ] ; var json = Jaxer.Serialization.toJSONString(items);</pre> The resulting JSON string will look like the following: <pre> [ [ "~1~","~1~" ] , "~Date:2007-08-17T11:57:30~" ] </pre> This format always has a top-level array whose first element is the root item that was originally being serialized. In this case, our top-most element was an array. As an aside, the only top-level elements that can generate this format are arrays, objects, and custom serialization objects. The first special format used for references and is defined with "~ # ~" where # is a number. The number is the index into the top-level array. The element at that index is the item that needs to be referenced where the reference string lives. In this example, once deserialization has completed, both instances of "~1~" will have been replaced with references to the deserialized date object. The next custom format, the date, shows how custom serializers emit text. The first item after the ~ but before the : is the name of the type. This is the fully-qualified type as you would have to type it in JavaScript to get to that type's constructor. The string after the : is in a format as generated by the type's custom serializer. The resulting string generated by the custom serializer is in turn serialized as a string, so the deserializer does not need to handle special characters or escape sequences. It is the responsibility of the custom deserializer to consume that text and to return effectively a clone of the original object. This module also allows a developer to register alternate top-level serialization and deserialization methods. The default method for serialization is 'nativeJSON' which attempts to use the built-in JSON support in the user agent, when available. In cases where 'nativeJSON' is not supported, the 'JSON' mode will be used. The developer can also use 'JSON' along with more options to customize serialization for special values like 'undefined', and 'INFINITY', for example. Finally, there is a 'Jaxer' mode as described above. This mode is used by Jaxer's framework and callback mechanisms and is available to developers that may need this advanced functionality. These serialization methods are specificed in a separate optional parameter to the "toJSONString" and 'fromJSONString" functions. Note that if the developer uses a non-default serialization method, then the developer is also responsible for using this same method for deserialization. Currenty, this implementation cannot detect which method was used for the original serialization step</div><a name="Jaxer.Serialization.Platform Support"></a><h2>Platform Support</h2><p><table cellspacing="2" width="90%"><tr class="compheader"><th class="browser">Jaxer Server Framework</th><th class="browser">Jaxer Client Framework</th></tr><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></table></p><a name="Jaxer.Serialization.Functions"></a><h2>Functions</h2><table cellspacing="2" width="90%"><tr class="compheader" visibility=""><th style="text-align:left">Method</th><th>Action</th><th class="browser">Jaxer Server Framework</th><th class="browser">Jaxer Client Framework</th></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.addDeserializer"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">addDeserializer</a>(<i>String</i>&nbsp;name, <i>Function</i>&nbsp;deserializer, [<i>Function</i>&nbsp;beforeDeserialization,] [<i>Function</i>&nbsp;afterDeserialization]) : <i>
			void
		</i></div><div class="description">Add a top-level JSON serializer</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>String</i></td><td width="10%"><b>name</b></td><td width="80%">The unique name of the deserializer. This name can be specified in the options object provided to the fromJSONString function. That will select this deserializer as the top-level function to deserialize the specified object. Note that case is not significant</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>deserializer</b></td><td width="80%">The function used to deserialized the JSON string created by the associated serializer.</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>beforeDeserialization</b></td><td width="80%"><b>(optional)</b>An optional function that will be called before the top-level deserialization process begins. This function should take a single parameter which will be the options object provided to the fromJSONString function. Note that the options object will be an inherited clone of the object sent to fromJSONString. This allows this function to initialize any data structures needed by the deserializer without altering the original options object passed into fromJSONString</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>afterDeserialization</b></td><td width="80%"><b>(optional)</b>An optional function that will be called after the top-level deserialization process ends. This function should take a single parameter which will be the options object provided to the fromJSONString function. Note that the options object will be an inherited clone of the object sent to the fromJSONString.</td></tr></table></p><dl class="details"></dl></td></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.addSerializer"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">addSerializer</a>(<i>String</i>&nbsp;name, <i>Function</i>&nbsp;serializer, [<i>Function</i>&nbsp;beforeSerialization,] [<i>Function</i>&nbsp;afterSerialization]) : <i>
			void
		</i></div><div class="description">Add a top-level JSON serializer</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>String</i></td><td width="10%"><b>name</b></td><td width="80%">The unique name of the serializer. This name can be specified in the options object provided to the toJSONString function. That will select this serializer as the top-level function to serialize the specified object. Note that case is not significant</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>serializer</b></td><td width="80%">The function used to serialize data. This function should take two arguments: the actual data to serialize and an options object</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>beforeSerialization</b></td><td width="80%"><b>(optional)</b>An optional function that will be called before the top-level serialization process begins. This function should take a single parameter which will be the options object provided to the toJSONString function. Note that the options object will be an inherited clone of the object sent to the toJSONString. This allows this function to initialize any data structures needed by the serializer without altering the original options object passed into toJSONString</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>afterSerialization</b></td><td width="80%"><b>(optional)</b>An optional function that will be called after the top-level serialization process ends. This function should take a single parameter which will be the options object provided to the toJSONString function. Note that the options object will be an inherited clone of the object sent to the toJSONString.</td></tr></table></p><dl class="details"></dl></td></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.addTypeHandler"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">addTypeHandler</a>(<i>String</i>&nbsp;name, <i>Function</i>&nbsp;serializer, <i>Function</i>&nbsp;deserializer, [<i>Function</i>&nbsp;canSerialize,] [<i>Function</i>&nbsp;canDeserialize]) : <i>
			void
		</i></div><div class="description">Add handlers for custom serialization/deserialization</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>String</i></td><td width="10%"><b>name</b></td><td width="80%">The fully-qualified name of the type. This should reflect the full, potentially dotted, notation you would need to use to access this type's constructor from the global context.</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>serializer</b></td><td width="80%">A function that takes an instance of the type it serializes and that returns a string representation of the type suitable as input into the deserializer</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>deserializer</b></td><td width="80%">A function that takes a string produced by the custom serializer and that returns a new instance of the custom supported type.</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>canSerialize</b></td><td width="80%"><b>(optional)</b>An optional function that takes an object instance and returns a boolean. This function should return true if it the current handler is able to serialize the object passed to it.</td></tr><tr><td width="10%"><i>Function</i></td><td width="10%"><b>canDeserialize</b></td><td width="80%"><b>(optional)</b>An optional function that takes an object instance and returns a boolean. This function should return true if it the current handler is able to deserialize the string passed to it.</td></tr></table></p><dl class="details"></dl></td></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.fromJSONString"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">fromJSONString</a>(<i>String</i>&nbsp;json, <i>Object</i>&nbsp;options) : <i>Object</i></div><div class="description">Reconstructs a Javascript data structure from a JSON string. Note that the serialization mode ('Jaxer', 'JSON', or 'nativeJSON') can be specified in the "options" parameter with the 'as' property. This will default to 'nativeJSON' when either no options are passed in or if the 'as' property is not defined. See Jaxer.Serialization.toJSONString for more details.</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>String</i></td><td width="10%"><b>json</b></td><td width="80%">A string in the JSON format</td></tr><tr><td width="10%"><i>Object</i></td><td width="10%"><b>options</b></td><td width="80%">The options objecct which can be used to control deserialization</td></tr></table></p><p class="padded"><b>Returns</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="20%"><i>Object</i></td><td width="80%">The resulting object graph after converting the JSON string to the equivalent Javascript data structure</td></tr></table></p><dl class="details"><dt>See Also</dt><dd><p><a href="Jaxer.Serialization.html#Jaxer.Serialization.toJSONString">Jaxer.Serialization.toJSONString</a></p></dd></dl></td></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.removeSerializer"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">removeSerializer</a>(<i>String</i>&nbsp;name) : <i>Boolean</i></div><div class="description">Remove support for the custom JSON serializer</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>String</i></td><td width="10%"><b>name</b></td><td width="80%">The name of the serializer to remove. Note that case is not significant</td></tr></table></p><p class="padded"><b>Returns</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="20%"><i>Boolean</i></td><td width="80%">Returns true if the serializer was successfully removed. Note that this function will return false if you attempt to remove a handler that is not already registered or if it is a built-in serializer like "jaxer".</td></tr></table></p><dl class="details"></dl></td></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.removeTypeHandler"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">removeTypeHandler</a>(<i>String</i>&nbsp;name) : <i>Boolean</i></div><div class="description">Remove support for custom serialization/deserialization for the specified type</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>String</i></td><td width="10%"><b>name</b></td><td width="80%">The fully qualified name of the type to remove</td></tr></table></p><p class="padded"><b>Returns</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="20%"><i>Boolean</i></td><td width="80%">Returns true if the handler was successfully removed. Note that this function will return false if you attempt to remove a handler that is not already registered.</td></tr></table></p><dl class="details"></dl></td></tr><tr class="item "><td class="declaration"><div class="name"><a name="Jaxer.Serialization.toJSONString"></a>static <a href="javascript:void(0);" onclick="toggleClickDetails(this)">toJSONString</a>(<i>Object</i>&nbsp;data, [<i>Object</i>&nbsp;options]) : <i>String</i></div><div class="description">Convert the specified object into a JSON representation. Note that we have modified JSON to support object references (cycles) and to convert Dates into a special format that will be recognized by our code during deserialization. This function includes an optional second parameter which can be used to control how the data is serialized. If the options parameter defines an 'as' property, that will be used to select the serialization format. Currently, the values 'Jaxer', 'JSON', and 'nativeJSON' are supported. 'Jaxer' includes support for cycles, multi-refs, and custom type serializers. 'JSON' and 'nativeJSON' follow the serialization format and semantics as defined by Douglas Crockford on the json.org website. When specifying the 'Jaxer' serializer, additional options are available. The "useCustomSerializers" has a boolean value which defaults to true. When this property is true, any type serializers that have been registered via addTypeHandler will be used in the serialization process. When this value is false, items needing custom serialization will be ignored as they would be in the "JSON" format. The "undefinedSerializationAction" property determines how the 'undefined' value is handled. The action defaults to 'serialize', but 'throw' is also supported which will throw an exception when trying to serialize 'undefined'. When specifying the 'JSON' serializer, additional options are available. The 'maxDepth' property, which defaults to 10, is used to prevent deep recursion. If the recursion level is encountered, the 'maxDepthAction' property determines the serializer's action. 'truncate' will emit a "__truncated__" string in place of the object that would cause the recursion level to be exceeded. 'throw' will throw an exception. The 'dateSerializationAction' property is used to determine how dates are processed. A value of 'serialize' will convert the date to a specially formatted string as described in the json.org example code. A value of 'throw' will throw an exception when a date is encountered. Finally, a value of "return object" will return an empty object in place of the Date itself. The 'undefinedSerializationAction' property is used to determine how 'undefined' is processed. A value of 'serialize' will convert the value to 'undefined'. 'throw' will throw an exception and 'nullify' will return 'null'. The 'specialNumberSerializationAction' property is used to determine how Infinity, -Infinity, and NaN are processed. A value of 'serialize' will convert the value to their text representation which is the same as the identifier used to represent them. 'throw' will throw an exception and 'nullify' will return null. When specifying the 'nativeJSON' serializer, the built-in native support for JSON serialization will be used, when available. This serialization does not support any custom options. In the case where 'nativeJSON' is specified but is not available, this mode will fallback to the 'JSON' mode with options specified in that mode to match the behavior of the native JSON implementation as specificed in the ECMAScript 3.1 specification. Note that other serializers can be registered with Jaxer. Most likely those serializers will define their own set of options. You will need to refer to the implementors documentation to determine those properties, their values, and their associated semantics.</div></td><td class="show-details"><a href="javascript:void(0);" onclick="toggleRowDetails(this)" style="color:#FFFFFF;">Show Details</a></td><td align="center" title="Jaxer Server Framework" class="comparison yes">1.0</td><td align="center" title="Jaxer Client Framework" class="comparison yes">1.0</td></tr><tr class="details-method"><td valign="top" colspan="4"><p class="padded"><b>Parameters</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="10%"><i>Object</i></td><td width="10%"><b>data</b></td><td width="80%">The source object to convert to a JSON string</td></tr><tr><td width="10%"><i>Object</i></td><td width="10%"><b>options</b></td><td width="80%"><b>(optional)</b>An optional object used to specify configuration info to the selected serializer</td></tr></table></p><p class="padded"><b>Returns</b><table cellspacing="1" width="90%" class="parameter-table"><tr><td width="20%"><i>String</i></td><td width="80%">The resulting JSON string which can be reversed back into the source object via Serialization.fromJSONString</td></tr></table></p><dl class="details"></dl></td></tr></table></div><div style="visibility:hidden;display:none"> aptana_docs</div></body></html>